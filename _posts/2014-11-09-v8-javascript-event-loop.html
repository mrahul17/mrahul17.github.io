---
layout: page
title: V8, Javascript, Event Loop
date: '2014-11-09T08:41:00.001-08:00'
author: light94
tags: [browser,javascript]
modified_time: '2014-11-09T08:55:19.886-08:00'
thumbnail: http://1.bp.blogspot.com/-gBIva1bvrUw/VF-Ka8s7aWI/AAAAAAAAFvs/ucJn4yBJwK0/s72-c/Screenshot%2Bfrom%2B2014-11-09%2B21%3A01%3A33.png
blogger_id: tag:blogger.com,1999:blog-4425839703382213369.post-7580893562423185412
blogger_orig_url: http://justanotherlearner.blogspot.com/2014/11/v8-javascript-event-loop.html
---

<div dir="ltr" style="text-align: left;" trbidi="on">This is what i understood form <a href="https://twitter.com/philip_roberts" target="_blank">Philip Robert's</a> speech at JSConf EU 2014<br />V8 is Google's Open Source Javascript Engine. It is written in C++ and is used in Google Chrome.<br /><br />The Big Picture,<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-gBIva1bvrUw/VF-Ka8s7aWI/AAAAAAAAFvs/ucJn4yBJwK0/s1600/Screenshot%2Bfrom%2B2014-11-09%2B21%3A01%3A33.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://1.bp.blogspot.com/-gBIva1bvrUw/VF-Ka8s7aWI/AAAAAAAAFvs/ucJn4yBJwK0/s1600/Screenshot%2Bfrom%2B2014-11-09%2B21%3A01%3A33.png" height="350" width="640" /></a></div><div class="separator" style="clear: both; text-align: center;"><br /></div><div class="separator" style="clear: both; text-align: left;"><br /></div><div class="separator" style="clear: both; text-align: left;"><br /></div><div class="separator" style="clear: both; text-align: left;">i.e Java runtime, webapi(extra things which the browser provides), event loop and the callback Queue.</div><div class="separator" style="clear: both; text-align: left;"><br /></div><div class="separator" style="clear: both; text-align: left;">Javascript is a <b>single threaded runtime, i.e it has a single call stack (it can execute only one piece of code at a time).</b></div><div class="separator" style="clear: both; text-align: left;">(Note: A call stack is basically a data structure which records where in the program we are.)</div><div class="separator" style="clear: both; text-align: left;"><br /></div><div class="separator" style="clear: both; text-align: left;"><b>Blocking - Essentially, it means code that is slow and therefore preventing execution of statements after it. </b>For example a while loop, which runs for say 100 times. Until the while loop is over , statements after it won't be executed. The browser cannot render anything until there is some process in the call stack.</div><div class="separator" style="clear: both; text-align: left;"><br /></div><div class="separator" style="clear: both; text-align: left;"><br /></div><div class="separator" style="clear: both; text-align: left;"><b>The solution to blocking - asynchronus callbacks.</b></div><div class="separator" style="clear: both; text-align: left;"><b><br /></b></div><div class="separator" style="clear: both; text-align: left;"><b>Now, the browser is more than the runtime </b>as shown in the picture. It has other components like <b>Web API, event loop which help in concurrency,i.e , executing more than one instruction at a time.</b></div><div class="separator" style="clear: both; text-align: left;"><b><br /></b></div><div class="separator" style="clear: both; text-align: left;"><b><br /></b></div><div class="separator" style="clear: both; text-align: left;"><b>Consider this piece of code&nbsp;</b></div><div class="separator" style="clear: both; text-align: left;"><b><br /></b></div><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-brEmt1d-u3o/VF-SEvkT65I/AAAAAAAAFv8/5Ug69D5Bm-k/s1600/10.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://3.bp.blogspot.com/-brEmt1d-u3o/VF-SEvkT65I/AAAAAAAAFv8/5Ug69D5Bm-k/s1600/10.png" height="197" width="320" /></a></div><div class="separator" style="clear: both; text-align: left;"><br /></div><div class="separator" style="clear: both; text-align: left;"><br /></div><div class="separator" style="clear: both; text-align: left;">If we look at the <b>call stack, the callback queue and the event loop together, we see the following picture initially.</b></div><div class="separator" style="clear: both; text-align: left;"><b><br /></b></div><div class="separator" style="clear: both; text-align: center;"><b><a href="http://2.bp.blogspot.com/-7DNhJpPawaw/VF-Sbxie81I/AAAAAAAAFwE/zu0pkr1W8fU/s1600/1.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://2.bp.blogspot.com/-7DNhJpPawaw/VF-Sbxie81I/AAAAAAAAFwE/zu0pkr1W8fU/s1600/1.png" height="216" width="400" /></a></b></div><div class="separator" style="clear: both; text-align: center;"><b><br /></b></div><div class="separator" style="clear: both; text-align: left;"><b>When we start the script,we find the picture to be this</b></div><div class="separator" style="clear: both; text-align: center;"><b><a href="http://3.bp.blogspot.com/-J7sZJ_gvjj0/VF-StRL8MpI/AAAAAAAAFwM/ucWRLdozpmQ/s1600/2.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://3.bp.blogspot.com/-J7sZJ_gvjj0/VF-StRL8MpI/AAAAAAAAFwM/ucWRLdozpmQ/s1600/2.png" height="217" width="400" /></a></b></div><div class="separator" style="clear: both; text-align: left;"><b>When <i>console.log('Hi') </i>is executed,</b></div><div class="separator" style="clear: both; text-align: left;"><b><br /></b></div><div class="separator" style="clear: both; text-align: center;"><b><a href="http://4.bp.blogspot.com/-AIci5ATyA6o/VF-S-_UNNsI/AAAAAAAAFwU/ZA0niuyDpBI/s1600/3.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://4.bp.blogspot.com/-AIci5ATyA6o/VF-S-_UNNsI/AAAAAAAAFwU/ZA0niuyDpBI/s1600/3.png" height="174" width="320" /></a></b></div><div class="separator" style="clear: both; text-align: left;"><b><br /></b></div><br />Now, as we saw before, <b>setTimeOut is a API provided by the browser, so setTimeOut(cb) sets off the timer and is then handled by the browser. So, <i>just after</i> the statement is executed, we find</b><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/-2FLU41TN1AI/VF-TxcfA7pI/AAAAAAAAFwg/8g-UCCmPWII/s1600/4.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://2.bp.blogspot.com/-2FLU41TN1AI/VF-TxcfA7pI/AAAAAAAAFwg/8g-UCCmPWII/s1600/4.png" height="174" width="320" /></a></div><div class="separator" style="clear: both; text-align: center;"><br /></div><div class="separator" style="clear: both; text-align: left;">that is, <b>the setTimeOut is not there in the callstack any more and thus the next console.log() statement is executed and clears off after which the main() clears off (pops off).The browser is handling the setTimeOut. The WebAPI cannot simply push the command back to stack.</b></div><div class="separator" style="clear: both; text-align: left;"><b><br /></b></div><div class="separator" style="clear: both; text-align: left;">Here comes the role of the <b>Event Loop </b>. It looks at the stack and at the queue. If the stack is empty, it pushes the first thing in the queue to the stack where it gets executed.</div><div class="separator" style="clear: both; text-align: left;"><br /></div><div class="separator" style="clear: both; text-align: left;">Note: We use a timer of 0 to setTimeOut when we do not want the statement to be executed until the stack is clear.</div><b><br /></b><i>setTimeOut is <b>not a guaranteed time of execution. It is the minimum time of execution.</b></i><br /><i><b><br /></b></i><i><b><br /></b></i><i><b><br /></b></i></div>